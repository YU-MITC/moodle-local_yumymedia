/**
 * YU Kaltura "My Media" script for acecss restriction setting.
 *
 * @copyright (C) 2016-2025 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_yumymedia/accessrestriction",["jquery"],(function($){return{init:function(){var STATUS_ENTRY_PRECONVERT=1,STATUS_ENTRY_READY=2,STATUS_ENTRY_PENDING=4;function centeringModalSyncer(){var w=$(window).width(),h=$(window).height(),cw=$("#modal_content").outerWidth(),ch=$("#modal_content").outerHeight();$("#modal_content").css({left:(w-cw)/2+"px",top:(h-ch)/2+"px"})}function fadeInModalWindow(){return $(this).blur(),!$("#modal_window")[0]&&($("body").append('<div id="modal_window"></div>'),$("#modal_window").fadeIn("slow"),centeringModalSyncer(),$("#modal_content").fadeIn("slow"),!0)}function addBackButton(url){$("#modal_content").append('<input type=button id="backToMymedia" name="backToMymedia" value=Back />'),$("#backToMyMedia").on("click",(function(){!function(url){location.href=url}(url)}))}function updateAccessControlId(){var entryStatus,findData,controlId=$("#access_control_select").val(),entryId=$("#entryid").val(),serverHost=$("#kalturahost").val(),ks=$("#ks").val(),fd=new FormData;fd.append("action","update"),fd.append("ks",ks),fd.append("entryId",entryId),fd.append("baseEntry:accessControlId",controlId);var postData={type:"POST",data:fd,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},serviceURL=serverHost+"/api_v3/service/baseEntry/action/update";$.ajax(serviceURL,postData).done((function(xmlData){if(null!=xmlData)if(null==(findData=$(xmlData).find("code"))||""===findData.text())if(null!=(findData=$(xmlData).find("status"))&&""!==findData.text())if((entryStatus=findData.text())==STATUS_ENTRY_READY||entryStatus==STATUS_ENTRY_PENDING||entryStatus==STATUS_ENTRY_PRECONVERT)if(null!=(findData=$(xmlData).find("accessControlId"))&&""!==findData.text()){var currentControl,resultId=findData.text();if(resultId==controlId)currentControl=resultId,require(["core/str","core/notification"],(function(str,notification){var strings=[{key:"accesscontrol_updated",component:"local_yumymedia"}];str.get_strings(strings).then((function(results){var mymedia=$("#mymedia").val();return $("#access_media_save").prop("disabled",!0),$("#currentcontrol").val(currentControl),fadeInModalWindow(),$("#modal_content").append("<p>"+results[0]+"</p><br>"),addBackButton(mymedia),sessionEnd(),setTimeout((function(){window.location.replace(mymedia)}),1e3),0})).fail(notification.exception)}));else printErrorMessage("Update failed(accessControlId: "+resultId+")")}else printErrorMessage("Update failed(Cannot get an accessControlId)");else printErrorMessage("Update failed (status of baseEntry: "+entryStatus+")");else printErrorMessage("Update failed (Cannot get a baseEntry)");else printErrorMessage("Update failed ("+findData.text()+")");else printErrorMessage("Update failed (Cannot get a XML response)")})).fail((function(xmlData){null!==xmlData&&window.console.dir(xmlData),printErrorMessage("Update fialed(Cannot connect to contents server)")}))}function printErrorMessage(message){var mymedia=$("#mymedia").val();message="<p><font color=red>"+message+"</font></p><br>",fadeInModalWindow(),$("#modal_content").append(message),addBackButton(mymedia),sessionEnd()}function sessionEnd(){var serviceURL=$("#kalturahost").val()+"/api_v3/service/session/action/end";$.ajax({type:"GET",url:serviceURL,cache:!1}).done((function(xmlData){null!==xmlData&&window.console.dir(xmlData)})).fail((function(xmlData){null!==xmlData&&window.console.dir(xmlData)}))}function printHtmlCode(){var selectedId=$("#code_type_select").val(),kalturaHost=$("#kalturahost").val(),partnerId=$("#partnerid").val(),uiconfId=$("#uiconfid").val(),playerstudio=$("#playerstudio").val(),entryId=$("#entryid").val(),now=Date.now(),str="";"0"==selectedId?"ovp"==playerstudio?(str+='<iframe type="text/javascript" src="'+kalturaHost+"/p/"+partnerId,str+="/embedPlaykitJs/uiconfid/"+uiconfId,str+="?iframeembed=true&entry_id="+entryId+'" ',str+='style="width: 560px; height: 395px" ',str+='allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" ',str+='allow="encrypted-media">',str+="</iframe>"):(str+='<iframe src="'+kalturaHost+"/p/"+partnerId+"/sp/"+partnerId+"00",str+="/embedIframeJs/uiconf_id/"+uiconfId+"/partner_id/"+partnerId,str+="?iframeembed=true&playerId=kaltura_player_"+now,str+="&entry_id="+entryId+'" width="560" height="395" ',str+='allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" ',str+='allow="encrypted-media"></iframe>'):(str=kalturaHost+"/index.php/extwidget/preview/partner_id/",str+=partnerId+"/uiconf_id/"+uiconfId+"/entry_id/"+entryId+"/embed/dynamic?"),$("#codearea").val(str)}$(window).on("unload",(function(){sessionEnd()})),$(window).resize(centeringModalSyncer),$("#access_control_select").on("change",(function(){require(["core/str","core/notification"],(function(str,notification){str.get_strings([{key:"heading_access_control",component:"local_yumymedia"},{key:"accesscontrol_changed",component:"local_yumymedia"}]).then((function(results){var selectedControlId=$("#access_control_select").val(),currentControlId=$("#currentcontrol").val(),newLabel=results[0];return selectedControlId!=currentControlId?(newLabel=newLabel+' <font color="red">('+results[1]+")</font>",$("#access_media_save").prop("disabled",!1)):$("#access_media_save").prop("disabled",!0),$("#access_control_label").html(newLabel),0})).fail(notification.exception)}))})),$("#code_type_select").on("change",(function(){printHtmlCode()})),$("#access_media_save").on("click",(function(){updateAccessControlId()})),printHtmlCode()}}}));

//# sourceMappingURL=accessrestriction.min.js.map