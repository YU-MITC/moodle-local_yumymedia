function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_yumymedia/simpleuploader",["jquery"],function(a){return{init:function init(){var y=0,z=0,A="",B=0,C={VIDEO:1,IMAGE:2,AUDIO:5},D={TRUE:1,FALSE:0,NULL:-1},E={ENTRY_IMPORTING:-2,ENTRY_CONVERTING:-1,ENTRY_IMPORT:0,ENTRY_PRECONVERT:1,ENTRY_READY:2,ENTRY_DELETED:3,ENTRY_PENDING:4,ENTRY_MODERATE:5,ENTRY_BLOCKED:6,ENTRY_NO_CONTENT:7},F={PENDING:0,PARTIAL_UPLOAD:1,FULL_UPLOAD:2,CLOSED:3,TIMED_OUT:4,DELETED:5};function b(){var b=a(window).width(),c=a(window).height(),d=a("#modal_content").outerWidth(),e=a("#modal_content").outerHeight();a("#modal_content").css({left:(b-d)/2+"px",top:(c-e)/2+"px"})}function c(){if(0>=B){return!1}if(2e9<B){return!1}return!0}function d(a){if(-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")||-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("video/mp4")||-1!=a.indexOf("video/ogg")||-1!=a.indexOf("video/quicktime")||-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")||-1!=a.indexOf("video/x-matroska")||-1!=a.indexOf("video/x-ms-wmv")||-1!=a.indexOf("video/webm")){return"video"}if(-1!=a.indexOf("audio/ac3")||-1!=a.indexOf("audio/ogg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mp4")||-1!=a.indexOf("audio/mp3")||-1!=a.indexOf("audio/wav")||-1!=a.indexOf("audio/x-ms-wma")){return"audio"}if(-1!=a.indexOf("image/gif")||-1!=a.indexOf("image/jpeg")||-1!=a.indexOf("image/png")||-1!=a.indexOf("image/tiff")){return"image"}return"N/A"}function e(){if(null===a("#fileData")||null===a("#fileData").files||""===a("#name").val()||""===a("#tags").val()||""===a("#type").val()||"N/A"===a("#type").val()){a("#entry_submit").prop("disabled",!0);a("#entry").val("")}else{a("#entry_submit").prop("disabled",!1)}}function f(){location.href="./yumymedia.php"}function g(){a(this).blur();if(a("#modal_window")[0]){return!1}var c=document.documentElement,d=document.body;y=c.scrollLeft||d.scrollLeft;z=c.scrollTop||d.scrollTop;a("body").append("<div id=\"modal_window\"></div>");a("#modal_window").fadeIn("slow");b();a("#modal_content").fadeIn("slow");return!0}function h(){window.scrollTo(y,z);a("#modal_content,#modal_window").fadeOut("slow",function(){a("#modal_window").remove();a("#modal_content").remove()})}function i(){require(["core/str"],function(b){var c=b.get_string("back_label","local_yumymedia",null);a.when(c).done(function(b){var c="<br><input type=button id=\"backToMymedia\" name=\"backToMymedia\" value=\"";c+=b+"\" />";a("#modal_content").append(c);a("#backToMymedia").on("click",function(){f()})})})}function j(b,c,d){if(""!==c&&""!==d){r()}a("#modal_content").append("<font color=\"red\">"+b+"</font><br>");i()}function k(b,c,d,e,g){require(["core/str","core/notification"],function(i,j){i.get_strings([{key:"upload_success",component:"local_yumymedia"},{key:"entryid_header",component:"local_yumymedia"},{key:"name_header",component:"local_yumymedia"},{key:"tags_header",component:"local_yumymedia"},{key:"desc_header",component:"local_yumymedia"},{key:"creatorid_header",component:"local_yumymedia"},{key:"back_label",component:"local_yumymedia"}]).then(function(i){h();var j="<h3>"+i[0]+"</h3>";j+="<table border=\"2\" cellpadding=\"5\">";j+="<tr><td>"+i[1]+"</td><td>"+b+"</td></tr>";j+="<tr><td>"+i[2]+"</td><td>"+c+"</td></tr>";j+="<tr><td>"+i[3]+"</td><td>"+d+"</td></tr>";j+="<tr><td>"+i[4]+"</td><td>"+e+"</td></tr>";j+="<tr><td>"+i[5]+"</td><td>"+g+"</td></tr>";j+="</table>";j+="<br>";j+="<input type=button id=\"backToMymedia\" name=\"backToMymedia\" value=\"";j+=i[6]+"\" />";a("#upload_info").html(j);a("#backToMymedia").on("click",function(){f()});return 0}).fail(j.exception)})}function l(){a("#file_info").html("");a("#type").val("")}function m(a){if(!0===/["$%&'~^\\`/]/.test(a)){return!1}else{return!0}}function n(a){if(!0===/[!"#$%&'~|^\\@`()[\]{}:;+*/=<>?]/.test(a)){return!1}else{return!0}}function o(){var b=a("#name").val(),c=a("#tags").val(),d=a("#description").val(),e=!0;if(!1===m(b)){require(["core/str"],function(b){var c=b.get_string("wrong_name","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}if(!1===n(c)){require(["core/str"],function(b){var c=b.get_string("wrong_tags","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}if(!1===m(d)){require(["core/str"],function(b){var c=b.get_string("wrong_desc","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}return e}function p(){var b=!0;if(!1===o()){b=!1}else if(!1===c()){require(["core/str"],function(b){var c=b.get_string("wrong_filesize","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});b=!1}else{a("#entry_submit").prop("disabled",!0);g();q();b=!0}return b}function q(){var b=a("#kalturahost").val(),c=a("#ks").val();s(b,c)}function r(b,c,d){var e=new FormData,f;e.append("action","delete");e.append("ks",c);e.append("uploadTokenId",d);a.ajax(b+"/api_v3/service/uploadToken/action/delete",{type:"POST",data:e,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"}).done(function(a){if(null===a){f=!1}f=!0}).fail(function(a){f=!1;if(null!==a){window.console.dir(a)}});return f}function s(b,c){var d,e,f=a("#fileData").prop("files")[0];B=parseInt(encodeURI(f.size));var g=b+"/api_v3/service/uploadToken/action/add?ks="+c;g=g+"&uploadToken:objectType=KalturaUploadToken";g=g+"uploadToken:fileName="+encodeURI(A);g=g+"&uploadToken:fileSize="+B;g=g+"&uploadToken:autoFinalize="+D.NULL;a.ajax(g,{type:"GET",cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",dataType:"xml"}).done(function(f){if(null===f){j("Cannot create upload token !<br>(Cannot get a XML response.)");return}e=a(f).find("code");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){j("Cannot create upload token !<br>("+e.text()+")");return}e=a(f).find("status");if(null===e||_typeof(e)===void 0||""===e.text()){j("Cannot create upload token !<br>(Cannot get status of upload token.)");return}var g=e.text();if(g!=F.PENDING){j("Cannot create upload token !<br>(UPLOAD_TOKEN_STATUS : "+g+")");return}e=a(f).find("id");if(null===e||_typeof(e)===void 0||""===e.text()){j("Cannot create uplaod token !<br>(Cannot get an uploadTokenId.)");return}d=e.text();setTimeout(function(){t(b,c,d)},1e3)}).fail(function(a){if(null!==a){window.console.dir(a)}j("Cannot create upload token !<br>(Cannot connect to kaltura server.)")})}function t(b,c,d){var e,f,g="",h="",i="",k="",l="",m=a("#name").val(),n=a("#tags").val(),o=a("#description").val(),p=a("#controlId").val(),q=a("#creatorId").val();m=m.trim();n=n.trim();if(null!==o){o=o.trim()}var s=new FormData;s.append("action","add");s.append("ks",c);s.append("entry:objectType","KalturaMediaEntry");var t=a("#type").val(),v="";if("image"==t){v=C.IMAGE}else if("audio"==t){v=C.AUDIO}else{v=C.VIDEO}s.append("entry:mediaType",v);s.append("entry:sourceType",1);s.append("entry:name",m);s.append("entry:tags",n);if(null!==o&&""!==o){s.append("entry:description",o)}else{s.append("entry:description","")}s.append("entry:categories",a("#categories").val());if(null!==p&&""!==p){s.append("entry:accessControlId",p)}s.append("entry:creatorId",q);s.append("entry:userId",q);a.ajax(b+"/api_v3/service/media/action/add",{type:"POST",data:s,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"}).done(function(m){if(null===m||_typeof(m)===void 0){r(b,c,d);j("Cannot create media entry !<br>(Cannot get a XML response.)");return}e=a(m).find("code");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){r(b,c,d);j("Cannot create media entry !<br>("+e.text()+")");return}e=a(m).find("status");if(null===e||_typeof(e)===void 0||""===e.text()){r(b,c,d);j("Cannot create media entyry !<br>(Cannot get a mediaEntryStatus.)");return}f=e.text();if(f!=E.ENTRY_NO_CONTENT){r(b,c,d);j("Cannot create media entry!<br>(mediaEntryStatus: "+f+")");return}e=a(m).find("id");g=e.text();e=a(m).find("name");h=e.text();e=a(m).find("tags");i=e.text();e=a(m).find("description");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){k=e.text()}else{k=""}e=a(m).find("creatorId");l=e.text();if(null===g||""===g||null===h||""===h||null===i||""===i||null===l||""===l||""!==o&&(null===k||""===k)){r(b,c,d);j("There exists wrong information(s) <br>");return}setTimeout(function(){u(b,c,d,g)},1e3)}).fail(function(a){if(null!==a){window.console.dir(a)}r(b,c,d);j("Cannot create media entry !<br>(Cannot connect to kaltura server.)")})}function u(b,c,d,e){var f,g=new FormData;require(["core/str","core/notification"],function(h,i){h.get_strings([{key:"uploader_uploading",component:"local_yumymedia"},{key:"progress",component:"local_yumymedia"},{key:"attach_file",component:"local_yumymedia"}]).then(function(h){a("#modal_content").append(h[0]+"<br>");var i="<p>"+h[1];i=i+": <span id=\"pvalue\" style=\"color:#00b200\">0.00</span> %</p>";a("#modal_content").append(i);g.append("action","upload");g.append("ks",c);g.append("uploadTokenId",d);g.append("fileData",a("input[name='fileData']").prop("files")[0],encodeURI(A),B);g.append("resume",!1);g.append("finalChunk",!0);g.append("resumeAt",0);a.ajax(b+"/api_v3/service/uploadToken/action/upload",{type:"POST",data:g,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function xhr(){var b=a.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",function(b){var c=parseInt(1e4*(parseInt(b.loaded)/parseInt(b.total)))/100;a("#pvalue").html(parseInt(c))},!1)}return b}}).done(function(g){if(null===g){r(b,c,d);j("Cannot upload the video !<br>(Cannot get a XML response.)");return}f=a(g).find("code");if(null!==f&&_typeof(f)!==void 0&&""!==f.text()){r(b,c,d);j("Cannot upload the video !<br>("+f.text()+")");return}f=a(g).find("status");if(null===f||_typeof(f)===void 0||""===f.text()){r(b,c,d);j("Cannot upload the video !<br>(Cannot get an uploadTokenStatus.)");return}var i=f.text();if(i!=F.FULL_UPLOAD&&i!=F.PARTIAL_UPLOAD){r(b,c,d);j("Cannot upload the video !<br>(UPLOAD_TOKEN_STATUS : "+i+")");return}else{window.console.log("File chunk have been transmitted.")}a("#modal_content").append(h[2]+"<br>");setTimeout(function(){v(b,c,d,e)},1e3)}).fail(function(a){if(null!==a){window.console.dir(a)}r(b,c,d);j("Cannot upload the file !<br>(Cannot connect to contents server.)")});return 0}).fail(i.exception)})}function v(b,c,d,e){var f,g="",h="",l="",m="",n,o=new FormData;o.append("action","addContent");o.append("ks",c);o.append("entryId",e);o.append("resource:objectType","KalturaUploadedFileTokenResource");o.append("resource:token",d);a.ajax(b+"/api_v3/service/media/action/addContent",{type:"POST",data:o,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"}).done(function(o){if(null===o||_typeof(o)===void 0){r(b,c,d);j("Cannot attach uploaded file !<br>(Cannot get a XML response.)");return}n=a(o).find("code");if(null!==n&&_typeof(n)!==void 0&&""!==n.text()){r(b,c,d);j("Cannot attach uploaded file !<br>("+n.text()+")");return}n=a(o).find("status");if(null===n||_typeof(n)===void 0||""===n.text()){r(b,c,d);j("Cannot attach uploaded file !<br>(Cannot get a mediaEntryStatus.)");return}f=n.text();if(f!=E.ENTRY_READY&&f!=E.ENTRY_PENDING&&f!=E.ENTRY_PRECONVERT&&f!=E.IMPORT&&f!=E.IMPORTING){r(b,c,d);j("Cannot attach uploaded file !<br>(mediaEntryStatus: "+f+")");return}n=a(o).find("id");e=n.text();n=a(o).find("name");g=n.text();n=a(o).find("tags");h=n.text();n=a(o).find("description");if(null!==n&&_typeof(n)!==void 0&&""!==n.text()){l=n.text()}else{l=""}n=a(o).find("creatorId");m=n.text();i();k(e,g,h,l,m)}).fail(function(a){if(null!==a){window.console.dir(a)}r(b,c,d);j("Cannot attach uploaded file !<br>(Cannot connect to kaltura server.)")})}function w(){var b="";if(a("#fileData")){var f=a("#fileData").prop("files")[0];B=parseInt(f.size);var g=d(encodeURI(f.type)),h=c();require(["core/str","core/notification"],function(c,d){c.get_strings([{key:"wrong_filesize",component:"local_yumymedia"},{key:"unsupported_filetype",component:"local_yumymedia"},{key:"filesize",component:"local_yumymedia"},{key:"mimetype",component:"local_yumymedia"}]).then(function(c){if(!1===h){b+=c[0]}if("N/A"==g){b+=c[1]}if(""!==b){window.alert(b);a("#file_info").html("");a("#name").val("");a("#tags").val("");a("#description").val("");a("#type").val("");a("#fileData").val("")}else{var d="",e="",i=0;A=f.name;if(B>1073741824){i=B/1073741824;e=i.toFixed(2)+" G"}else if(B>1048576){i=B/1048576;e=i.toFixed(2)+" M"}else if(1024<B){i=B/1024;e=i.toFixed(2)+" k"}else{e=B+" "}d+="<div id=metadata_fields>";d+=c[2]+": "+e+"bytes<br>";d+=c[3]+":"+encodeURI(f.type)+"<br>";d+="</div><hr>";a("#file_info").html(d);a("#name").val(A);a("#type").val(g)}return 0}).fail(d.exception)})}e()}function x(){var b=a("#kalturahost").val();a.ajax({type:"GET",url:b+"/api_v3/service/session/action/end",cache:!1}).done(function(a){if(null===a){window.console.log("Cannot delete the uploadToken ! (Cannot get a XML response.)")}else{window.console.log("Kaltura Session has been deleted.")}}).fail(function(a){window.console.log("Cannot delete the uploadToken ! (Cannot connect to content server.)");if(null!==a){window.console.dir(a)}})}a(window).on("change",function(){e()});a(window).on("unload",function(){x()});a(window).resize(b);a("#fileData").on("change",function(){w()});a("#uploader_cancel").on("click",function(){f()});a("#name").on("change",function(){e()});a("#tags").on("change",function(){e()});a("#entry_submit").on("click",function(){p()});a("#entry_reset").on("click",function(){l()});e()}}});
//# sourceMappingURL=simpleuploader.min.js.map
