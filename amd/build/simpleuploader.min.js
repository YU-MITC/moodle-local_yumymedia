define(["jquery"],function(a){return{init:function(){function b(){var b=a(window).width(),c=a(window).height(),d=a("#modal_content").outerWidth(),e=a("#modal_content").outerHeight();a("#modal_content").css({left:(b-d)/2+"px",top:(c-e)/2+"px"})}function c(){return 0>=y?!1:y>2e9?!1:!0}function d(a){return-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")||-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("video/mp4")||-1!=a.indexOf("video/ogg")||-1!=a.indexOf("video/quicktime")||-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")||-1!=a.indexOf("video/x-matroska")||-1!=a.indexOf("video/x-ms-wmv")||-1!=a.indexOf("video/webm")?"video":-1!=a.indexOf("audio/ac3")||-1!=a.indexOf("audio/ogg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mp4")||-1!=a.indexOf("audio/wav")||-1!=a.indexOf("audio/x-ms-wma")?"audio":-1!=a.indexOf("image/gif")||-1!=a.indexOf("image/jpeg")||-1!=a.indexOf("image/png")||-1!=a.indexOf("image/tiff")?"image":"N/A"}function e(){null===a("#fileData")||null===a("#fileData").files||""===a("#name").val()||""===a("#tags").val()||""===a("#type").val()||"N/A"===a("#type").val()?(a("#entry_submit").prop("disabled",!0),a("#entry").val("")):a("#entry_submit").prop("disabled",!1)}function f(){location.href="./yumymedia.php"}function g(){if(a(this).blur(),a("#modal_window")[0])return!1;var c=document.documentElement,d=document.body;return w=c.scrollLeft||d.scrollLeft,x=c.scrollTop||d.scrollTop,a("body").append('<div id="modal_window"></div>'),a("#modal_window").fadeIn("slow"),b(),a("#modal_content").fadeIn("slow"),!0}function h(){window.scrollTo(w,x),a("#modal_content,#modal_window").fadeOut("slow",function(){a("#modal_window").remove(),a("#modal_content").remove()})}function i(){var b='<br><input type=button id="backToMymedia" name="backToMymedia" value="Back" />';a("#modal_content").append(b),a("#backToMymedia").on("click",function(){f()})}function j(b){a("#modal_content").append('<font color="red">'+b+"</font><br>"),i()}function k(b,c,d,e,g){h();var i="<h3>Your upload has been suceeded !</h3>";i+='<table border="2" cellpadding="5">',i+="<tr><td>entry id</td><td>"+b+"</td></tr>",i+="<tr><td>name</td><td>"+c+"</td></tr>",i+="<tr><td>tags</td><td>"+d+"</td></tr>",i+="<tr><td>description</td><td>"+e+"</td></tr>",i+="<tr><td>creator id</td><td>"+g+"</td></tr>",i+="</table>",i+="<br>",i+='<input type=button id="backToMymedia" name="backToMymedia" value="Back" />',a("#upload_info").html(i),a("#backToMymedia").on("click",function(){f()})}function l(){a("#file_info").html(""),a("#type").val("")}function m(a){var b=/["$%&'~\^\\`\/]/;return b.test(a)===!0?!1:!0}function n(a){var b=/[!"#$%&'~\|\^\\@`()\[\]\{\}:;\+\*\/=<>?]/;return b.test(a)===!0?!1:!0}function o(){var b=a("#name").val(),c=a("#tags").val(),d=a("#description").val();return m(b)===!1?(window.alert("There is wrong letter(s) in <Name>."),!1):n(c)===!1?(window.alert("There is wrong letter(s) in <Tags>."),!1):m(d)===!1?(window.alert("There is wrong letter(s) in <Description>."),!1):!0}function p(){return o()===!1?(window.alert("Wrong metadata."),!1):c()===!1?(window.alert("Wrong file size."),!1):(g(),q(),!0)}function q(){var b=a("#kalturahost").val(),c=a("#ks").val();s(b,c)}function r(b,c,d){var e,f=new FormData;f.append("action","delete"),f.append("ks",c),f.append("uploadTokenId",d);var g={type:"POST",data:f,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"},h=b+"/api_v3/service/uploadToken/action/delete";return a.ajax(h,g).done(function(a){null===a&&(e=!1),e=!0}).fail(function(a){e=!1,null!==a&&window.console.dir(a)}),e}function s(b,c){var d,e,f=new FormData;f.append("action","upload"),f.append("fileData",a("input[name='fileData']").prop("files")[0]),f.append("ks",c);var g={type:"POST",data:f,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function(){var b=a.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(b){var c=parseInt(b.loaded/b.total*1e4)/100;a("#pvalue").html(parseInt(c))},!1),b}},h=b+"/api_v3/service/media/action/upload";a("#modal_content").append("Uploading a media file ...<br>"),a("#modal_content").append('<p>Progress: <span id="pvalue" style="color:#00b200">0.00</span> %</p>'),a.ajax(h,g).done(function(f,g,h){return null===f?(r(b,c,d),void j("Cannot upload the file !<br>(Cannot get a XML response.)")):(e=a(f).find("code"),null!==e&&void 0!==typeof e&&""!==e.text()?void j("Cannot upload the file !<br>("+e.text()+")"):(e=a(f).find("result"),null===e||void 0===typeof e||""===e.text()?void j("Cannot upload the file !<br>(Cannot get an uploadTokenId.)"):(d=e.text(),a("#modal_content").append("Uploading an attirbute information ...<br>"),void setTimeout(function(){t(b,c,d)},1e3))))}).fail(function(a){r(b,c,d),null!==a&&window.console.dir(a),j("Cannot upload the file !<br>(Cannot connect to content server.)")})}function t(b,c,d){var e,f,g="",h="",l="",m="",n="",o=a("#type").val(),p="";p="image"==o?z.IMAGE:"audio"==o?z.AUDIO:z.VIDEO;var q=a("#name").val(),s=a("#tags").val(),t=a("#description").val(),u=a("#controlId").val();q=q.trim(),s=s.trim(),null!==t&&(t=t.trim());var v=new FormData;v.append("action","addFromUploadedFile"),v.append("ks",c),v.append("uploadTokenId",d),v.append("mediaEntry:name",q),v.append("mediaEntry:tags",s),null!==t&&""!==t?v.append("mediaEntry:description",t):v.append("mediaEntry:description",""),v.append("mediaEntry:categories",a("#categories").val()),v.append("mediaEntry:creatorId",a("#creatorId").val()),v.append("mediaEntry:userId",a("#creatorId").val()),v.append("mediaEntry:mediaType",p),v.append("mediaEntry:accessControlId",u);var w={type:"POST",data:v,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},x=b+"/api_v3/service/media/action/addFromUploadedFile";a.ajax(x,w).done(function(o){return null===o||void 0===typeof o?(r(b,c,d),void j("Cannot upload the attribute information !<br>(Cannot get a XML response.)")):(e=a(o).find("code"),null!==e&&void 0!==typeof e&&""!==e.text()?(r(b,c,d),void j("Cannot upload the attribute information !<br>("+e.text()+")")):(e=a(o).find("status"),null===e||void 0===typeof e||""===e.text()?(r(b,c,d),void j("Cannot upload the attribute information !<br>(Cannot get a mediaEntryStatus.)")):(f=e.text(),f!=A.ENTRY_READY&&f!=A.ENTRY_PENDING&&f!=A.ENTRY_PRECONVERT?(r(b,c,d),void j("Cannot upload the attribute information !<br>(mediaEntryStatus: "+f+")")):(e=a(o).find("id"),g=e.text(),e=a(o).find("name"),h=e.text(),e=a(o).find("tags"),l=e.text(),e=a(o).find("description"),m=null!==e&&void 0!==typeof e&&""!==e.text()?e.text():"",e=a(o).find("creatorId"),n=e.text(),i(),void k(g,h,l,m,n)))))}).fail(function(a){r(b,c,d),null!==a&&window.console.dir(a),j("Cannot upload the attribute information !<br>(Cannot connect to content server.)")})}function u(){if(a("#fileData")){var b=a("#fileData").prop("files")[0];y=parseInt(encodeURI(b.size));var f=d(encodeURI(b.type)),g=c(),h="";if(g===!1&&(h+="Wrong file size."),"N/A"==f&&(h+="Unsupported file type."),""!==h)window.alert(h),a("#file_info").html(""),a("#name").val(""),a("#tags").val(""),a("#description").val(""),a("#type").val(""),a("#fileData").val("");else{var i="",j=b.name,k="";y>1073741824?(y/=1073741824,k=y.toFixed(2)+" G"):y>1048576?(y/=1048576,k=y.toFixed(2)+" M"):y>1024?(y/=1024,k=y.toFixed(2)+" k"):k=y+" ",i+="<div id=metadata_fields>",i+="Size: "+k+"bytes<br>",i+="MIME Type: "+encodeURI(b.type)+"<br>",i+="</div><hr>",a("#file_info").html(i),a("#name").val(j),a("#type").val(f)}}e()}function v(){var b=a("#kalturahost").val(),c=b+"/api_v3/service/session/action/end";a.ajax({type:"GET",url:c,cache:!1}).done(function(a){null===a?window.console.log("Cannot delete the uploadToken ! (Cannot get a XML response.)"):window.console.log("Kaltura Session has been deleted.")}).fail(function(a){window.console.log("Cannot delete the uploadToken ! (Cannot connect to content server.)"),null!==a&&window.console.dir(a)})}var w=0,x=0,y=0,z={VIDEO:1,IMAGE:2,AUDIO:5},A={ENTRY_IMPORTING:-2,ENTRY_CONVERTING:-1,ENTRY_IMPORT:0,ENTRY_PRECONVERT:1,ENTRY_READY:2,ENTRY_DELETED:3,ENTRY_PENDING:4,ENTRY_MODERATE:5,ENTRY_BLOCKED:6,ENTRY_NO_CONTENT:7};a(window).on("change",function(){e()}),a(window).on("unload",function(){v()}),a(window).resize(b),a("#fileData").on("change",function(){u()}),a("#uploader_cancel").on("click",function(){f()}),a("#name").on("change",function(){e()}),a("#tags").on("change",function(){e()}),a("#entry_submit").on("click",function(){p()}),a("#entry_reset").on("click",function(){l()}),e()}}});