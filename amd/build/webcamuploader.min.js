define(["jquery"],function(a){return{init:function(){function b(){var a=navigator.userAgent.toLowerCase(),b=navigator.appVersion.toLowerCase(),c=a.indexOf("msie")>-1&&-1==a.indexOf("opera"),d=c&&b.indexOf("msie 6.")>-1,e=c&&b.indexOf("msie 7.")>-1,f=c&&b.indexOf("msie 8.")>-1,g=c&&b.indexOf("msie 9.")>-1,h=c&&b.indexOf("msie 10.")>-1,i=a.indexOf("trident/7")>-1;return c||d||e||f||g||h||i}function c(){var a=navigator.userAgent.toLowerCase(),b=a.indexOf("edge")>-1,c=a.indexOf("chrome")>-1&&-1==a.indexOf("edge"),d=a.indexOf("firefox")>-1,e=a.indexOf("safari")>-1&&-1==a.indexOf("chrome"),f=a.indexOf("opera")>-1;return b===!0&&c===!1&&d===!1&&e===!1&&f===!1}function d(){var d="";if(b()||c()){var e="";return e=b()?"Internet Explorer":"Edge",d='<p><font color="red">Sorry!!<br>',d=d+"This uploader don't support your web browser ("+e+").<br>",d+="Please use other browser.</font></p>",d+='<br><input type=button id="backToMymedia" name="backToMymedia" value="Back" />',a("#upload_info").html(d),a("#backToMymedia").on("click",function(){p()}),!0}return!1}function e(b){var c="";c='<p><font color="red">'+b+"</font></p>",c+='<br><input type=button id="backToMymedia" name="backToMymedia" value="Back" />',a("#upload_info").html(c),a("#backToMymedia").on("click",function(){p()})}function f(b){var c='<video id="webcam" width="'+M+'" height="'+N+'" ';c=c+'src="'+b+'" autoplay="false" oncontextmenu="return false;" controls></video>',a("#videospan").html(c),document.getElementById("webcam").pause(),document.getElementById("webcam").currentTime=0}function g(b){var c='<video id="webcam" width="'+M+'" height="'+N+'" ';c+='autoplay="0" muted oncontextmenu="return false;"></video>',a("#videospan").html(c),a("#webcam").attr("src",b)}function h(){a("#recstop").attr("src",a("#stopurl").val()),a("#recstop").off("click"),a("#recstop").on("click",function(){i()}),a("#leftspan").css("display","inline"),a("#webcam").volume=0,S.start(),a("#status").html('<font color="red">Now, recording...</font>')}function i(){S.ondataavailable=function(b){P=new Blob([b.data],{type:b.data.type}),R=U(P),f(R),J=P.size;var c="",d=0;J>1073741824?(d=J/1073741824,c=d.toFixed(2)+" G"):J>1048576?(d=J/1048576,c=d.toFixed(2)+" M"):J>1024?(d=J/1024,c=d.toFixed(2)+" k"):c=J+" ",a("#status").html('<font color="green">Video preview ('+P.type+", "+c+"B).</font>"),L=m(P.type),K=l(),K===!1&&window.alert("Wrong file size."),o(),Q=a("#filename").val()+"."+n(P.type)},S.stop(),a("#leftspan").css("display","none"),a("#rightspan").css("display","inline"),a("#remove").on("click",function(){j()})}function j(){var b="";if(!d()){navigator.mediaDevices=navigator.mediaDevices||(navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(a){return new Promise(function(b,c){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,a,b,c)})}}:null);try{if(null===navigator.mediaDevices||void 0===navigator.mediaDevices||null===MediaRecorder||void 0===MediaRecorder)return b="This uploader requires the WebRTC.<br>",b+="Howerver, your web browser don't support the WebRTC.<br>",b+="Please use other browser.",void e(b)}catch(c){return b="This uploader requires the WebRTC.<br>",b+="Howerver, your web browser don't support the WebRTC.<br>",b+="Please use other browser.",void e()}try{if(null===U||void 0===U||null===V||void 0===V)return b="This uploader requires the createObjectURL/revokeObjectURL.<br>",b+="Howerver, your web browser don't support these function.<br>",b+="Please use other browser.",void e(b)}catch(c){return b="This uploader requires the WebRTC.<br>",b+="Howerver, your web browser don't support the WebRTC.<br>",b+="Please use other browser.",void e(b)}g(null),null!==R&&(V(R),R=null,P=null),null!==O&&void 0!==O.stop&&O.stop(),J=0,K=!1,L="",a("#recstop").off("click"),a("#remove").off("click"),a("#webcam").off("ondataavailable");var f="";f=MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?"video/webm; codecs=vp8":MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?"video/webm; codecs=vp9":MediaRecorder.isTypeSupported("video/webm")?"video/webm":"video/mp4",T={audioBitsPerSecond:128e3,videoBitsPerSecond:15e5,mimeType:f,audio:{echoCancellation:!1},video:{mandatory:{minWidth:320,minHeight:240,maxWidth:1280,maxHeight:720,minFrameRate:5,maxFrameRate:15},optional:[{facingMode:"user"}]}};var i=navigator.mediaDevices.getUserMedia(T);i.then(function(b){O=b,R=U(O),a("#webcam").attr("src",R),window.console.log(O),S=new MediaRecorder(O,T),a("#recstop").attr("src",a("#recurl").val()),a("#recstop").on("click",function(){h()}),a("#leftspan").css("display","inline"),a("#rightspan").css("display","none"),a("#status").html("Camera preview.")}),i["catch"](function(a){var b="Your webcamera is not supported, ";b+="or it is already used.<br>",b=b+="Please check your webcamera.",e(b),window.console.log(a)}),o()}}function k(){var b=a(window).width(),c=a(window).height(),d=a("#modal_content").outerWidth(),e=a("#modal_content").outerHeight();a("#modal_content").css({left:(b-d)/2+"px",top:(c-e)/2+"px"})}function l(){return 0>=J?!1:J>2e9?!1:!0}function m(a){return-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")||-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("video/mp4")||a.indexOf("video/ogg")||-1!=a.indexOf("video/quicktime")||-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")||-1!=a.indexOf("video/x-matroska")||-1!=a.indexOf("video/x-ms-wmv")||-1!=a.indexOf("video/webm")?"video":-1!=a.indexOf("audio/ac3")||-1!=a.indexOf("audio/ogg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mp4")||-1!=a.indexOf("audio/mp3")||-1!=a.indexOf("audio/wav")||-1!=a.indexOf("audio/x-ms-wma")?"audio":-1!=a.indexOf("image/gif")||-1!=a.indexOf("image/jpeg")||-1!=a.indexOf("image/png")||-1!=a.indexOf("image/tiff")?"image":"N/A"}function n(a){return-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")?"avi":-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mpg")?"mpeg":-1!=a.indexOf("video/mp4")||-1!=a.indexOf("video/m4v")||-1!=a.indexOf("audio/mp4")?"mp4":-1!=a.indexOf("video/ogg")?"ogg":-1!=a.indexOf("video/quicktime")?"mov":-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/VP9")||-1!=a.indexOf("video/vp8")||-1!=a.indexOf("video/vp9")||-1!=a.indexOf("video/webm")?"webm":-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")?"flv":-1!=a.indexOf("video/x-matroska")?"mkv":-1!=a.indexOf("video/x-ms-wmv")?"wmv":-1!=a.indexOf("audio/ac3")?"ac3":-1!=a.indexOf("audio/ogg")?"ogg":-1!=a.indexOf("audio/wav")?"wav":-1!=a.indexOf("audio/x-ms-wma")?"wma":-1!=a.indexOf("image/gif")?"gif":-1!=a.indexOf("image/jpeg")?"jpg":-1!=a.indexOf("image/png")?"png":-1!=a.indexOf("image/tiff")?"tiff":"webm"}function o(){null===R||null===P||0===P.size||K===!1||""===a("#name").val()||""===a("#tags").val()||""===L||"N/A"===L?(a("#entry_submit").prop("disabled",!0),a("#entry").val("")):a("#entry_submit").prop("disabled",!1)}function p(){location.href="./yumymedia.php"}function q(){if(a(this).blur(),a("#modal_window")[0])return!1;var b=document.documentElement,c=document.body;return H=b.scrollLeft||c.scrollLeft,I=b.scrollTop||c.scrollTop,a("body").append('<div id="modal_window"></div>'),a("#modal_window").fadeIn("slow"),k(),a("#modal_content").fadeIn("slow"),!0}function r(){window.scrollTo(H,I),a("#modal_content,#modal_window").fadeOut("slow",function(){a("#modal_window").remove(),a("#modal_content").remove()})}function s(){var b='<br><input type=button id="backToMymedia" name="backToMymedia" value="Back" />';a("#modal_content").append(b),a("#backToMymedia").on("click",function(){p()})}function t(b){a("#modal_content").append('<font color="red">'+b+"</font><br>"),s()}function u(b,c,d,e,f){r();var g="<h3>Your upload has been suceeded !</h3>";g+='<table border="2" cellpadding="5">',g+="<tr><td>entry id</td><td>"+b+"</td></tr>",g+="<tr><td>name</td><td>"+c+"</td></tr>",g+="<tr><td>tags</td><td>"+d+"</td></tr>",g+="<tr><td>description</td><td>"+e+"</td></tr>",g+="<tr><td>creator id</td><td>"+f+"</td></tr>",g+="</table>",g+="<br>",g+='<input type=button id="backToMymedia" name="backToMymedia" value="Back" />',a("#upload_info").html(g),a("#backToMymedia").on("click",function(){p()})}function v(){a("#file_info").html(""),a("#type").val("")}function w(a){var b=/["$%&'~^\\`\/]/;return b.test(a)===!0?!1:!0}function x(a){var b=/[!"#$%&'~|^\\@`()[\]{}:;+*\/=<>?]/;return b.test(a)===!0?!1:!0}function y(){var b=a("#name").val(),c=a("#tags").val(),d=a("#description").val();return w(b)===!1?(window.alert("There is wrong letter(s) in <Name>."),!1):x(c)===!1?(window.alert("There is wrong letter(s) in <Tags>."),!1):w(d)===!1?(window.alert("There is wrong letter(s) in <Description>."),!1):!0}function z(){return y()===!1?(window.alert("Wrong metadata."),!1):l()===!1?(window.alert("Wrong file size."),!1):(q(),A(),!0)}function A(){var b=a("#kalturahost").val(),c=a("#ks").val();C(b,c)}function B(b,c,d){var e,f=new FormData;f.append("action","delete"),f.append("ks",c),f.append("uploadTokenId",d);var g={type:"POST",data:f,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"},h=b+"/api_v3/service/uploadToken/action/delete";return a.ajax(h,g).done(function(a){null===a&&(e=!1),e=!0}).fail(function(a){e=!1,null!==a&&window.console.dir(a)}),e}function C(b,c){var d,e,f={type:"GET",cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",dataType:"xml"},g=b+"/api_v3/service/uploadToken/action/add?ks="+c;g+="&uploadToken:objectType=KalturaUploadToken",g=g+"uploadToken:fileName="+encodeURI(Q),g=g+"&uploadToken:fileSize="+P.size,g=g+"&uploadToken:autoFinalize="+X.NULL,a.ajax(g,f).done(function(f){if(null===f)return void t("Cannot create upload token !<br>(Cannot get a XML response.)");if(e=a(f).find("code"),null!==e&&void 0!==typeof e&&""!==e.text())return void t("Cannot create upload token !<br>("+e.text()+")");if(e=a(f).find("status"),null===e||void 0===typeof e||""===e.text())return void t("Cannot create upload token !<br>(Cannot get status of upload token.)");var g=e.text();return g!=Z.PENDING?void t("Cannot create upload token !<br>(UPLOAD_TOKEN_STATUS : "+g+")"):(e=a(f).find("id"),null===e||void 0===typeof e||""===e.text()?void t("Cannot create uplaod token !<br>(Cannot get an uploadTokenId.)"):(d=e.text(),void setTimeout(function(){D(b,c,d)},1e3)))}).fail(function(a){null!==a&&window.console.dir(a),t("Cannot create upload token !<br>(Cannot connect to kaltura server.)")})}function D(b,c,d){var e,f,g="",h="",i="",j="",k="",l=a("#name").val(),m=a("#tags").val(),n=a("#description").val(),o=a("#controlId").val(),p=a("#creatorId").val();l=l.trim(),m=m.trim(),null!==n&&(n=n.trim());var q=new FormData;q.append("action","add"),q.append("ks",c),q.append("entry:objectType","KalturaMediaEntry"),q.append("entry:mediaType",W.VIDEO),q.append("entry:sourceType",1),q.append("entry:name",l),q.append("entry:tags",m),null!==n&&""!==n?q.append("entry:description",n):q.append("entry:description",""),q.append("entry:categories",a("#categories").val()),null!==o&&""!==o&&q.append("entry:accessControlId",o),q.append("entry:creatorId",p),q.append("entry:userId",p);var r={type:"POST",data:q,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},s=b+"/api_v3/service/media/action/add";a.ajax(s,r).done(function(l){return null===l||void 0===typeof l?(B(b,c,d),void t("Cannot create media entry !<br>(Cannot get a XML response.)")):(e=a(l).find("code"),null!==e&&void 0!==typeof e&&""!==e.text()?(B(b,c,d),void t("Cannot create media entry !<br>("+e.text()+")")):(e=a(l).find("status"),null===e||void 0===typeof e||""===e.text()?(B(b,c,d),void t("Cannot create media entyry !<br>(Cannot get a mediaEntryStatus.)")):(f=e.text(),f!=Y.ENTRY_NO_CONTENT?(B(b,c,d),void t("Cannot create media entry!<br>(mediaEntryStatus: "+f+")")):(e=a(l).find("id"),g=e.text(),e=a(l).find("name"),h=e.text(),e=a(l).find("tags"),i=e.text(),e=a(l).find("description"),j=null!==e&&void 0!==typeof e&&""!==e.text()?e.text():"",e=a(l).find("creatorId"),k=e.text(),null===g||""===g||null===h||""===h||null===i||""===i||null===k||""===k||""!==n&&(null===j||""===j)?(B(b,c,d),void t("There exists wrong information(s) <br>")):void setTimeout(function(){E(b,c,d,g)},1e3)))))}).fail(function(a){null!==a&&window.console.dir(a),B(b,c,d),t("Cannot create media entry !<br>(Cannot connect to kaltura server.)")})}function E(b,c,d,e){var f,g=new FormData;a("#modal_content").append("Uploading a recorded video ..."),a("#modal_content").append('<p>Progress: <span id="pvalue" style="color:#00b200">0.00</span> %</p>'),g.append("action","upload"),g.append("ks",c),g.append("uploadTokenId",d),g.append("fileData",P,encodeURI(Q),P.size),g.append("resume",!1),g.append("finalChunk",!0),g.append("resumeAt",0);var h={type:"POST",data:g,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function(){var b=a.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(b){var c=parseInt(b.loaded/b.total*1e4)/100;a("#pvalue").html(parseInt(c))},!1),b}},i=b+"/api_v3/service/uploadToken/action/upload";a.ajax(i,h).done(function(g,h,i){if(null===g)return B(b,c,d),void t("Cannot upload the video !<br>(Cannot get a XML response.)");if(f=a(g).find("code"),null!==f&&void 0!==typeof f&&""!==f.text())return B(b,c,d),void t("Cannot upload the video !<br>("+f.text()+")");if(f=a(g).find("status"),null===f||void 0===typeof f||""===f.text())return B(b,c,d),void t("Cannot upload the video !<br>(Cannot get an uploadTokenStatus.)");var j=f.text();return j!=Z.FULL_UPLOAD&&j!=Z.PARTIAL_UPLOAD?(B(b,c,d),void t("Cannot upload the video !<br>(UPLOAD_TOKEN_STATUS : "+j+")")):(window.console.log("Ffile chunk have been transmitted."),a("#modal_content").append("Attach uploaded file ...<br>"),void setTimeout(function(){F(b,c,d,e)},1e3))}).fail(function(a){null!==a&&window.console.dir(a),B(b,c,d),t("Cannot upload the file !<br>(Cannot connect to contents server.)")})}function F(b,c,d,e){var f,g,h="",i="",j="",k="",l=new FormData;l.append("action","addContent"),l.append("ks",c),l.append("entryId",e),l.append("resource:objectType","KalturaUploadedFileTokenResource"),l.append("resource:token",d);var m={type:"POST",data:l,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"},n=b+"/api_v3/service/media/action/addContent";a.ajax(n,m).done(function(l){return null===l||void 0===typeof l?(B(b,c,d),void t("Cannot attach uploaded file !<br>(Cannot get a XML response.)")):(g=a(l).find("code"),null!==g&&void 0!==typeof g&&""!==g.text()?(B(b,c,d),void t("Cannot attach uploaded file !<br>("+g.text()+")")):(g=a(l).find("status"),null===g||void 0===typeof g||""===g.text()?(B(b,c,d),void t("Cannot attach uploaded file !<br>(Cannot get a mediaEntryStatus.)")):(f=g.text(),f!=Y.ENTRY_READY&&f!=Y.ENTRY_PENDING&&f!=Y.ENTRY_PRECONVERT&&f!=Y.IMPORT&&f!=Y.IMPORTING?(B(b,c,d),void t("Cannot attach uploaded file !<br>(mediaEntryStatus: "+f+")")):(g=a(l).find("id"),e=g.text(),g=a(l).find("name"),h=g.text(),g=a(l).find("tags"),i=g.text(),g=a(l).find("description"),j=null!==g&&void 0!==typeof g&&""!==g.text()?g.text():"",g=a(l).find("creatorId"),k=g.text(),s(),void u(e,h,i,j,k)))))}).fail(function(a){null!==a&&window.console.dir(a),B(b,c,d),t("Cannot attach uploaded file !<br>(Cannot connect to kaltura server.)")})}function G(){var b=a("#kalturahost").val(),c=b+"/api_v3/service/session/action/end";a.ajax({type:"GET",url:c,cache:!1}).done(function(a){null===a?window.console.log("Cannot delete the uploadToken ! (Cannot get a XML response.)"):window.console.log("Kaltura Session has been deleted.")}).fail(function(a){window.console.log("Cannot delete the uploadToken ! (Cannot connect to kaltura server.)"),null!==a&&window.console.dir(a)})}var H=0,I=0,J=0,K=!1,L="",M=400,N=300,O=null,P=null,Q="",R=null,S=null,T=null,U=window.URL&&window.URL.createObjectURL?function(a){return window.URL.createObjectURL(a)}:window.webkitURL&&window.webkitURL.createObjectURL?function(a){return window.webkitURL.createObjectURL(a)}:void 0,V=window.URL&&window.URL.revokeObjectURL?function(a){return window.URL.revokeObjectURL(a)}:window.webkitURL&&window.webkitURL.revokeObjectURL?function(a){return window.webkitURL.revokeObjectURL(a)}:void 0,W={VIDEO:1,IMAGE:2,AUDIO:5},X={TRUE:1,FALSE:0,NULL:-1},Y={ENTRY_IMPORTING:-2,ENTRY_CONVERTING:-1,ENTRY_IMPORT:0,ENTRY_PRECONVERT:1,ENTRY_READY:2,ENTRY_DELETED:3,ENTRY_PENDING:4,ENTRY_MODERATE:5,ENTRY_BLOCKED:6,ENTRY_NO_CONTENT:7},Z={PENDING:0,PARTIAL_UPLOAD:1,FULL_UPLOAD:2,CLOSED:3,TIMED_OUT:4,DELETED:5};a(window).on("change",function(){o()}),a(window).on("load",function(){a("#name").val(""),a("#tags").val(""),a("#description").val("")}),j(),a(window).on("unload",function(){null!==R&&(V(R),P=null,R=null),null!==O&&O.stop(),G()}),a(window).resize(k),a("#uploader_cancel").on("click",function(){p()}),a("#name").on("change",function(){o()}),a("#tags").on("change",function(){o()}),a("#entry_submit").on("click",function(){z()}),a("#entry_reset").on("click",function(){v()})}}});